---
title: HTTP cache
---

import {MultiCodeBlock} from 'gatsby-theme-apollo-docs';

Apollo Android provides two different kinds of caches: an HTTP cache and a normalized cache. The HTTP cache is easier to set up but also has more limitations. This page focuses on the HTTP cache. If you want to deduplicate the storage of your objects and/or notify your UI when your data changes, take a look at the [normalized cache](./normalized-cache) instead.

## HTTP cache

To enable HTTP cache support, add the dependency to your project's `build.gradle file. The latest version is
[![Maven Central](https://img.shields.io/maven-central/v/com.apollographql.apollo3/apollo-api)](https://repo1.maven.org/maven2/com/apollographql/apollo3/)

```kotlin:title=build.gradle
dependencies {
  implementation("com.apollographql.apollo3:apollo-http-cache:x.y.z")
}
```

### Raw HTTP response cache

<MultiCodeBlock>

```kotlin:title=Kotlin
// Directory where cached responses will be stored
val directory = File(cacheDir, "apolloCache")

// Size in bytes of the cache
val maxSize: Long = 1024 * 1024

// Build the ApolloClient
val apolloClient = ApolloClient.Builder()
    .serverUrl("/")
    .httpCache(directory = directory, maxSize = maxSize)
    .build()
                   
// Control the fetch policy  
val query = ApolloRequest.Builder(FeedQuery(limit = 10, type = FeedType.HOT))
    .httpFetchPolicy(HttpFetchPolicy.CacheFirst)
    .build()
val dataResponse = apolloClient.query(query)
```

```java:title=Java
// Directory where cached responses will be stored
File directory = new File(cacheDir, "apolloCache");

// Size in bytes of the cache
long maxSize = 1024 * 1024;

// Build the ApolloClient
ApolloClient apolloClient = HttpCacheExtensionsKt.httpCache(
    new ApolloClient.Builder().serverUrl("/"),
    directory,
    maxSize
  )
  .build();
Rx2ApolloClient rx2ApolloClient = new Rx2ApolloClient(apolloClient, Schedulers.io());

// Control the fetch policy
ApolloRequest<FeedQuery.Data> query = HttpCacheExtensionsKt.httpFetchPolicy(
    new ApolloRequest.Builder<>(new FeedQuery(10, FeedType.HOT)),
    HttpFetchPolicy.CacheFirst
  )
  .build();

ApolloResponse<FeedQuery.Data> response = rx2ApolloClient.query(query).blockingGet();
```

</MultiCodeBlock>

**IMPORTANT:** Caching is provided only for `query` operations. It isn't available for `mutation` operations.

There are four available cache policies in `HttpFetchPolicy`:

- `NetworkOnly` - Fetch a response from the network only, ignoring any cached responses. This is the default.
- `CacheOnly` - Fetch a response from the cache only, ignoring the network. If the cached response doesn't exist or is expired, then return
  an error.
- `CacheFirst` - Fetch a response from the cache first. If the response doesn't exist or is expired, then fetch a response from the network.
- `NetworkFirst` - Fetch a response from the network first. If the network fails and the cached response isn't expired, then return cached
  data instead.

