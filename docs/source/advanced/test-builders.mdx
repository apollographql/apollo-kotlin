---
title: 'Test Builders'
---

> Note: Test Builders are experimental and subject to change. We'd love to have your feedback on them. Things that worked well, things that can be improved, etc.. Feel free to reach out either through [Github issues](https://github.com/apollographql/apollo-android/issues/new?assignees=&labels=Type%3A+Bug&template=bug_report.md&title=[Test Builders]) or the [Kotlinlang slack channel](https://app.slack.com/client/T09229ZC6/C01A6KM1SBZ).

Apollo Android generates model classes based on your operations. You can then use these classes in your
project, which means you will probably need to instantiate them in your tests.

However, if your models have many fields or their hierarchy is deep, you may find it tedious to instantiate them
manually - as a value must be set for each field.

To make it easier, Apollo Android provides Test Builders: an optional mechanism that helps to build these models, with default values.
Additionally, Test Builders will populate `__typename` for you and deduplicate merged fields when possible.

As it may not be useful to all users and it generates more code, test builder generation is not enabled by default. To
enable it, set the `generateTestBuilders` option to `true`:

```kotlin:title=build.gradle[.kts]
apollo {
  // ...

  // Enable test builder generation
  generateTestBuilders.set(true)
  
  // Optionally, you may customize the output path
  testDir.set(file("test-builders"))
}
```

This will generate a builder DSL for each model used by your operations. These DSLs are based on the model's
fields, and allow you to set the values of the fields you care about for your specific tests, while default values will
automatically be set for the other fields.

For example, given this query:

```graphql
query HeroForEpisode($ep: Episode!) {
  hero(episode: $ep) {
    firstName
    lastName
    age
    ... on Droid {
      primaryFunction
    }

    ... on Human {
      height
    }
  }
}
```

Here is how you would use the corresponding test builder:

```kotlin
import com.example.test.HeroForEpisodeQuery_TestBuilder.Data

@Test
fun test() {
  val data = HeroForEpisodeQuery.Data {
    hero = humanHero {
      firstName = "John"
      age = 42
    }
  }

  assertEquals("John", data.hero.firstName)
  assertEquals(42, data.hero.age)
}
```

In this example we create a Human Hero with specific values for `firstName` and `age`, and the values for `lastName`
and `height` are automatically filled with mock values.

### Advanced usage

To automatically assign values to the fields for which you don't explicit set a value, the builder uses a `TestResolver`
which is by default `DefaultTestResolver`.

`DefaultTestResolver` will give String fields the field's name as their value, increment a counter for Int values, etc.

You can instead pass your own `TestResolver` implementation (extend `DefaultTestResolver` for a head start) as a
parameter to the `Data` function, like so:

```kotlin
// A TestResolver that assign -1 to Int fields
val myTestResolver = object : DefaultTestResolver() {
  override fun resolveInt(path: List<Any>): Int {
    return -1
  }
}

@Test
fun test() {
  val data = HeroForEpisodeQuery.Data(testResolver = myTestResolver) {
    hero = humanHero {
      firstName = "John"
    }
  }

  // Unspecified Int field is -1
  assertEquals(-1, data.hero.age)
}
```
